# -*-coding:utf-8 -*-import re, os, string,timefrom commands import getstatusoutput as gsoimport subprocessfile_path = '/data/yunwei/gameVersion'hub_dir = '/data/game/hub_'file = '/data/yunwei/gameVersion/base/hub_list.txt'def upata_hub():	hub_list = input_hub()	file, filename = input_file()	input_len = len(hub_list)	print u"你输入的HUB是%s\n共计%s个\n更新版本是%s,是否确认？" % (hub_list, input_len, filename)	input = raw_input()	if input not in ['y', 'Y']:		print u"退出操作"		exit(1)	else:		kills = kill_progres(hub_list)		if kills:			check = check_progres(hub_list)			print check			if check:				for hub in hub_list:					cmd = 'unzip -o %s -d /data/game/hub_%s' % (file, hub)					status, result = gso(cmd)					if not status:						print u"hub解压完成"						start_hub(hub)def restart_hub():	hub_list = input_hub()	input_len = len(hub_list)	print u"你输入的HUB是%s,共计%s个,是否确认？" %(hub_list,input_len)	input = raw_input()	if input not in ['y', 'Y']:		print u"退出操作"		exit(1)	else:		kills = kill_progres(hub_list)		if kills:			check = check_progres(hub_list)			if check:				for hub in hub_list:					start_hub(hub)def kill_progres(hub_list):	for progres in hub_list:		cmd = "ps aux|grep Hub|grep -w %s|grep -v grep|awk {'print $2'}" % progres		status, result = gso(cmd)		print u"HUB进程是：%s"%result		cmd_1 = "kill -9 %s" % result		status,result = gso(cmd_1)		print status,result		if status:			print u"HUB进程%s已杀死" % progres	return 1def check_progres(hub_list):	print hub_list	a = ' -e '.join(hub_list)	while True:		cmd = "netstat -lapn|grep -v grep|grep -w -e %s" % a		status, result = gso(cmd)		if not result:			print u"端口已关闭"			break		else:			time.sleep(2)			print u"端口还没释放...."			continue	return 1def start_hub(hub):	#for progres in hub_list:	path = hub_dir + hub + '/linux'	print path	os.chdir(path)	cmd = "sh startHub.sh"	status, result = gso(cmd)	print status	if not result:		print u"hub启动成功"	else:		print u"启动失败"def input_hub():	print u"输入需要操作的hub号(全选all)："	input = raw_input()	if input == 'all':		f = open(file)		hub_list = []		for line in f:			hub_list.append(line.split('|')[2].strip())		print hub_list		return hub_list		f.close()	else:		str = input.replace(' ', '')		if not str.isdigit():			print u'请输入数字'			exit(1)		else:			hub_list = input.split()			print hub_list			return hub_listdef input_file():	print u"输入需要更新的版本文件："	input = raw_input()	file = os.path.join(file_path, input)	if not os.path.isfile(file):		print u"文件不存在！"		exit(1)	else:		return file, inputif __name__ == '__main__':	print u'选择操作：1、更新HUB   2、重启HUB',	input = raw_input()	if input not in ['1', '2']:		print u"退出操作"		exit(1)	elif input == '1':		'''更新操作'''		upata_hub()	elif input == '2':		'''重启操作'''		restart_hub()